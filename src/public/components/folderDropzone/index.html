<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<title></title>

	<style>
		html,
		body {
			height: 100%;
			padding: 0;
			margin: 0;
		}

		* {
			-webkit-user-select: none;
		}

		#dropzone {
			width: 100%;
			height: 100%;

			border: 2px solid;
			box-sizing: border-box;
			background: #000;
			color: #000;

			display: table;

			/*background-image: url('');
			background-repeat: no-repeat;
			background-position: 50% 50%;*/

			transition: color 0.25s linear, background-color 0.25s linear, border-color 0.25s linear;
		}

		.icon{
			display: table-cell;
			vertical-align: middle;
			text-align: center;
		}
		
		.icon svg {
			width: 33%;
			height: 33%;
		}

		.icon polygon,
		.icon polyline,
		.icon line {
			stroke-width: 1.25;
			transition: stroke 0.25s linear;
		}

		button {
			-webkit-app-region: no-drag;
		}
	</style>
</head>
<body style="-webkit-app-region: drag">
<div id="dropzone">
		<div class="icon">
			<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"  x="0px" y="0px"
			 width="64px" height="64px" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve">
				<polygon fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" points="63,18 63,54 1,54 1,10 22,10 30,18 "/>
				<polyline fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="bevel" stroke-miterlimit="10" points="40,37 32,45
					24,37 "/>
				<g>
					<line fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" x1="32" y1="45" x2="32" y2="25"/>
				</g>
			</svg>
		</div>
</div>
<div style="position: absolute; bottom: 10px; left: 10px">
	<button id="reload">reload</button>
</div>

<script type="text/javascript">
	(function () {
		// Get the current window aka this
		var win = require('nw.gui').Window.get();

		var styleHandler = {
			_style: null,

			_background: localStorage.getItem('background'),
			_color     : localStorage.getItem('color'),
			_inverted  : localStorage.getItem('inverted'),
			_invertedColor: localStorage.getItem('invertedColor'),

			init: function () {
				//this._head = document.head;
				var style = document.createElement('style');
				style.type = 'text/css';

				style.appendChild(document.createTextNode(''));
				this._style = style;
				document.head.appendChild(this._style);

				window.addEventListener('storage', this.onUpdate.bind(this), true);

				this.updateStyles();
			},

			onUpdate: function (e) {
				var changed = false;

				if (e.key === 'background') {
					this._background = e.newValue;
					changed = true;
				}
				else if (e.key === 'color') {
					this._color = e.newValue;
					changed = true;
				}

				else if (e.key === 'inverted') {
					this._inverted = e.newValue;
				}

				else if (e.key === 'invertedColor') {
					this._invertedColor = e.newValue;
				}

				if (changed) {
					this.updateStyles();
				}
			},

			updateStyles: function () {
				var dropzoneStyles = [
							'background-color: ' + this._inverted,
							'color: ' + this._invertedColor,
							'border-color: ' + this._invertedColor
				];

				var dropzoneHoverStyles = [
							'background-color: ' + this._invertedColor,
							'color: ' + this._inverted,
							'border-color: ' + this._inverted
				];

				var styles = [
							'#dropzone { ' + dropzoneStyles.join(';\n') + ' }',
							'#dropzone.hover { ' + dropzoneHoverStyles.join(';\n') + ' }',
							'.icon polygon, .icon polyline, .icon line { stroke: ' + this._invertedColor + '}',
							'#dropzone.hover .icon polygon, #dropzone.hover .icon polyline, #dropzone.hover line { stroke: ' + this._inverted + '}'
				];

				this._style.innerHTML = styles.join('\n');
			}
		};

		styleHandler.init();

		window.onload = function () {

			var dropzone = document.getElementById('dropzone');

			// prevent default behavior from changing page on dropped file
			window.ondragover = function (e) {
				e.preventDefault();
				return false
			};
			window.ondrop = function (e) {
				e.preventDefault();
				return false
			};

			dropzone.ondragenter = function () {
				this.className = 'hover';
				return false;
			};
			dropzone.ondragleave = function () {
				this.className = '';
				return false;
			};
			dropzone.ondrop = function (e) {
				var paths = [];

				e.preventDefault();

				this.className = '';

				for (var i = 0, l = e.dataTransfer.items.length; i < l; i++) {
					var entry = e.dataTransfer.items[i].webkitGetAsEntry();

					if (entry.isFile) {
						console.log('files are not supported!');
					}
					else if (entry.isDirectory) {
						paths.push(e.dataTransfer.files[i].path);
					}
				}

				if (paths.length) {
					win.emit('drop', paths);
				}
			};
		};

		document.getElementById('reload').onclick = function () {
			win.reload();
			win.showDevTools();
		}
	})();
</script>
</body>
</html>